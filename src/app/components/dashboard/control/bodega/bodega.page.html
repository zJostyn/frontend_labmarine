<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Control de Bodega</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding content-container">

  <div class="main-layout-grid">

    <div class="form-container">
      <h3 class="ion-text-center">Agregar Nuevo Movimiento</h3>
      <form (ngSubmit)="agregarMovimiento()" #bodegaForm="ngForm">

        <ion-item lines="none" class="ion-margin-vertical input-item-custom">
          <ion-label position="stacked">Descripción</ion-label>
          <ion-input [(ngModel)]="nuevoMovimiento.descripcion" name="descripcion" required
            placeholder="Escribe una descripción"></ion-input>
        </ion-item>

        <ion-item lines="none" class="ion-margin-vertical input-item-custom">
          <ion-label position="stacked">Kilos (Peso)</ion-label>
          <ion-input [(ngModel)]="nuevoMovimiento.kilos" name="kilos" type="number" required
            placeholder="0"></ion-input>
        </ion-item>

        <ion-item lines="none" class="ion-margin-vertical input-item-custom">
          <ion-label position="stacked">Sacos (Cantidad)</ion-label>
          <ion-input [(ngModel)]="nuevoMovimiento.sacos" name="sacos" type="number" required
            placeholder="0"></ion-input>
        </ion-item>

        <ion-button expand="block" type="submit" color="success"
          [disabled]="!bodegaForm.form.valid || nuevoMovimiento.kilos <= 0 || nuevoMovimiento.sacos <= 0"
          class="ion-margin-top register-button">
          <ion-icon name="save-outline" slot="start"></ion-icon>
          Registrar Movimiento
        </ion-button>
      </form>
    </div>

    <div class="tables-wrapper">

      <div class="table-container ion-margin-bottom">
        <h3 class="ion-text-center">Movimientos Registrados</h3>
        <div class="responsive-table-wrap">
          <table class="movimientos-table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Descripción</th>
                <th>Kilos</th>
                <th>Sacos (Llevados)</th>
                <th>Lleva</th>
                <th>Devuelve</th>
                <th>Cant. Devuelta</th>
                <th>Responsable</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let mov of movimientos"
                [ngClass]="{ 'warn-row': mov.devuelve === '' || mov.devuelve == null || (mov.devuelve === 'Si' && mov.cant_devuelta === null) }">
                <td>{{ mov.fecha | date: 'dd/MM/yyyy' }}</td>
                <td>{{ mov.descripcion }}</td>
                <td>{{ mov.kilos }}</td>
                <td>{{ mov.sacos }}</td>
                <td>{{ mov.lleva }}</td>
                <td>
                  <select [(ngModel)]="mov.devuelve" (ngModelChange)="onDevuelveChange(mov)" name="devuelve_{{mov.id}}"
                    [disabled]="isDevuelveDisabled(mov)">
                    <option value="">Pendiente</option>
                    <option value="Si">Sí</option>
                    <option value="No">No</option>
                  </select>
                </td>
                <td>{{ mov.cant_devuelta ?? 'N/A' }}</td>
                <td>{{ mov.responsable }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="totals-container">
        <h3 class="ion-text-center">Resumen de Totales</h3>
        <table class="totals-table">
          <thead>
            <tr>
              <th class="bg-kilos">Total Kilos</th>
              <th class="bg-sacos">Total Sacos (Llevados)</th>
              <th class="bg-devuelto">Total Sacos Devueltos</th>
              <th class="bg-restante">Total Sacos Restantes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="bg-kilos">{{ totalKilos | number:'1.0-2' }}</td>
              <td class="bg-sacos">{{ totalSacos | number:'1.0-2' }}</td>
              <td class="bg-devuelto">{{ totalDevuelto | number:'1.0-2' }}</td>
              <td class="bg-restante">{{ totalRestante | number:'1.0-2' }}</td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
  </div>
</ion-content>